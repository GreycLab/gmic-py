name: CPython GMIC Manylinux build
# Ugly mix of https://github.com/htm-community/htm.core/blob/master/.github/workflows/build.yml and https://github.com/pypa/python-manylinux-demo

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.7]
        os: [ubuntu-18.04]
    steps:
      - uses: actions/checkout@v1
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v1
        with:
          python-version: ${{ matrix.python-version }}
      - name: build and run manylinux1 for x86_64
        env:
          DOCKER_IMAGE: quay.io/pypa/manylinux1_x86_64
          PLAT: manylinux1_x86_64
        run: |
          docker pull $DOCKER_IMAGE
          docker run --rm -e PLAT=$PLAT -v `pwd`/cpython:/io find /io
          docker run --rm -e PLAT=$PLAT -v `pwd`/cpython:/io $DOCKER_IMAGE $PRE_CMD /io/travis/build-wheels.sh
          ls wheelhouse/

# notifications:
#   email: false
# 
# matrix:
#   include:
#     - sudo: required
#       services:
#         - docker
#       env: DOCKER_IMAGE=quay.io/pypa/manylinux1_x86_64
#            PLAT=manylinux1_x86_64
#     - sudo: required
#       services:
#         - docker
#       env: DOCKER_IMAGE=quay.io/pypa/manylinux1_i686
#            PRE_CMD=linux32
#            PLAT=manylinux1_i686
#     - sudo: required
#       services:
#         - docker
#       env: DOCKER_IMAGE=quay.io/pypa/manylinux2010_x86_64
#            PLAT=manylinux2010_x86_64
# 
# install:
#   - docker pull $DOCKER_IMAGE
# 
# script:
#   - docker run --rm -e PLAT=$PLAT -v `pwd`/cpython:/io $DOCKER_IMAGE $PRE_CMD /io/travis/build-wheels.sh
#   - ls wheelhouse/
# 
